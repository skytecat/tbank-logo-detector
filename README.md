- Добавить инфу про дубли в валидационной выборке
- Добавить ссылки на данные
- Подробную инструкцию добавить
- Добавить результаты модели

# Детекция логотипа Т-Банка
## Оглавление

- [Описание задачи](#-описание-задачи)
- [Подход к решению](#подход-к-решению)
- [Инструкция по запуску](#-инструкция-по-запуску)
- [Контракт API](#-контракт-api)
- [Метрики качества]
- [Валидационный набор]
- [Ссылки на ресурсы]
- [Анализ и предложения по улучшению]

---

## Описание задачи

Цель — создать REST API сервис, который детектирует логотип Т-Банка (стилизованная буква “Т” в щите) на загружаемых изображениях и возвращает координаты bounding box’ов.  
Логотипы “Тинькофф” должны игнорироваться.  
Решение должно быть упаковано в Docker, запускаться на порту 8000 и соответствовать Pydantic-спецификации

---

## Подход к решению

### 1. Подготовка данных
#### 1. Загрузка датасета
Из исходного датасета было выбрано 3000 изображений, которые были разделены на папки по 200 изображений (part_1, part_2, ...) — для удобства обработки

#### 2. Автоматический отбор изображений с потенциальными логотипами (zero-shot подход)
Для подготовки данных использован zero-shot подход, не требующий предварительной разметки:

Template Matching (OpenCV)
Метод: cv2.matchTemplate с методом TM_CCOEFF_NORMED — поиск похожих областей на изображении.
Шаблоны: Использовано 6 шаблонов логотипа Т-Банка (разных размеров, цветов и углу поворота) для повышения охвата.
Адаптация: Если шаблон больше изображения — он автоматически уменьшается пропорционально.
Порог совпадения: MATCH_THRESHOLD = 0.65 — баланс между точностью и полнотой.

Скрипт проходит по всем частям, применяет Template Matching, и копирует подходящие изображения в специальную папку.
В результате отобрано более **300** изображений с высокой вероятностью наличия логотипа Т-Банка

#### 3. Ручная разметка bounding box’ов
На основе автоматически отобранных изображений была проведена качественная ручная разметка с использованием интерактивного инструмента на базе ipywidgets. Подход позволил гибко корректировать результаты автоматического отбора и обеспечивать высокую точность аннотаций

**Категории изображений при разметке:**
- Корректно размеченные автоматически — на некоторых изображениях рамка, предложенная Template Matching, полностью соответствовала реальному положению логотипа. Такие изображения принимались “как есть” — с сохранением одной (наилучшей) рамки.
- Требующие корректировки — в большинстве случаев автоматическая рамка была близка к истине, но требовала небольшой подгонки (смещение, изменение размера)
- Ошибочно отобранные — некоторые изображения прошли автоматический отбор, но на них логотип отсутствовал. Такие изображения либо пропускались и не попадали в папку с положительными изображениями

**Дополнительно создано 30 положительных примеров**
Для улучшения обобщающей способности модели вручную были созданы и размечены 30 дополнительных положительных изображений — с логотипами в нестандартных условиях (мелкие, под углом, на сложном фоне)

**Формат и результат**
Все аннотации сохранены в формате YOLO: class x_center y_center width height (относительные координаты).
Разметка хранится в папке, где каждый .txt файл соответствует изображению с тем же именем

Итог: получено ~150 качественно размеченных изображений

#### 4. Добавление негативных примеров
Добавлено 30 изображений без логотипа — с пустыми .txt файлами.
Цель: снижение количества ложных срабатываний (false positives)

#### 5. Разделение данных
Датасет разделён на train (80%) и val (20%) с помощью train_test_split с фиксированным random_state=42 для воспроизводимости.
К негативным примерам (изображения без логотипа) применено пропорциональное разделение — чтобы сохранить баланс классов в обеих выборках

### 2. Обучение модели
Для детекции логотипа Т-Банка была выбрана архитектура YOLOv8n (от Ultralytics) — как оптимальный баланс между скоростью, точностью и потреблением ресурсов, особенно актуальный для небольшого датасета (~200 изображений).

**Обучение проводилось с использованием следующих параметров:**
**Эпох: 100**
Достаточно для сходимости на малом датасете, без переобучения

**Размер изображения: 640x640**
Стандартный размер для YOLO, баланс детализации и скорости

**Размер батча: 16**

**Аугментации: Включены**
Ключевой фактор для улучшения обобщения на малом датасете

**Использованные аугментации**
Для повышения устойчивости модели к вариациям в реальных условиях применены следующие аугментации:

- hsv_h=0.015, hsv_s=0.7, hsv_v=0.4 — вариации оттенка, насыщенности и яркости для имитации разного освещения и цветовых условий
- degrees=10.0 — случайные повороты ±10° — для устойчивости к наклонным логотипам
- scale=0.5 — масштабирование от 0.5x до 1.5x — для детекции логотипов разного размера
- mosaic=1.0 — смешивание 4 изображений в одно (учит модель детектировать объекты на сложном фоне и в кластерах)
- fliplr=0.5 — горизонтальное отражение с вероятностью 50% 

### 3. Результаты модели

### 4. Упаковка в Docker
- Сервис на **FastAPI**
- Контейнер собирается одной командой, запускается на порту 8000
- Все зависимости зафиксированы в `requirements.txt`
